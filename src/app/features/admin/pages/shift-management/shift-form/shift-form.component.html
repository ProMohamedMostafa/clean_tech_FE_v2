<div class="shift-main-wrapper">
  <div class="shift-form-wrapper">
    <header class="shift-header">
      <div class="header-content">
        <h2 class="shift-title">
          {{
            (isEditMode ? "shiftForm.editTitle" : "shiftForm.title") | translate
          }}
        </h2>
        <p class="shift-description">
          {{
            (isEditMode ? "shiftForm.editDescription" : "shiftForm.description")
              | translate
          }}
        </p>
        <div class="header-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="48"
            height="48"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
        </div>
      </div>
    </header>

    @if (!loading) {
    <form (submit)="submitShift()" class="shift-form">
      <div class="form-stepper">
        <div class="stepper-step active">
          <div class="step-number">1</div>
          <div class="step-label">
            {{ "shiftForm.steps.basicInfo" | translate }}
          </div>
        </div>
        <div class="stepper-step" [class.active]="selectedLevel">
          <div class="step-number">2</div>
          <div class="step-label">
            {{ "shiftForm.steps.levelAssignment" | translate }}
          </div>
        </div>
      </div>

      <div class="shift-form-grid">
        <!-- Left Column: Name, Date, Time -->
        <section class="shift-section basic-info-section">
          <h3 class="section-subtitle">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            {{ "shiftForm.basicInfo.title" | translate }}
          </h3>

          <!-- Shift Name -->
          <div class="form-group">
            <label for="name" class="form-label">
              {{ "shiftForm.fields.shiftName.label" | translate }}
              <span class="required-indicator">*</span>
            </label>
            <div class="input-with-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
              </svg>
              <input
                type="text"
                id="name"
                name="shiftName"
                [placeholder]="
                  'shiftForm.fields.shiftName.placeholder' | translate
                "
                class="form-control"
                [(ngModel)]="shiftData.name"
                #shiftName="ngModel"
                required
              />
            </div>
            @if (shiftName.invalid && shiftName.touched) {
            <div class="error-message">
              @if (shiftName.errors?.['required']) {
              <div>
                {{ "shiftForm.validation.shiftNameRequired" | translate }}
              </div>
              }
            </div>
            }
          </div>

          <!-- Date Range -->
          <div class="form-row">
            <div class="form-group">
              <label for="startDate" class="form-label">
                {{ "shiftForm.fields.startDate" | translate }}
                <span class="required-indicator">*</span>
              </label>
              <div class="input-with-icon">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <input
                  type="date"
                  id="startDate"
                  name="startDate"
                  class="form-control"
                  [(ngModel)]="shiftData.startDate"
                  (change)="validateDates()"
                  #startDate="ngModel"
                  required
                />
              </div>
              @if (startDate.invalid && startDate.touched) {
              <div class="error-message">
                @if (startDate.errors?.['required']) {
                <div>
                  {{ "shiftForm.validation.startDateRequired" | translate }}
                </div>
                }
              </div>
              }
            </div>
            <div class="form-group">
              <label for="endDate" class="form-label">
                {{ "shiftForm.fields.endDate" | translate }}
                <span class="required-indicator">*</span>
              </label>
              <div class="input-with-icon">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <input
                  type="date"
                  id="endDate"
                  name="endDate"
                  class="form-control"
                  [(ngModel)]="shiftData.endDate"
                  (change)="validateDates()"
                  #endDate="ngModel"
                  required
                />
              </div>
              @if (endDate.invalid && endDate.touched) {
              <div class="error-message">
                @if (endDate.errors?.['required']) {
                <div>
                  {{ "shiftForm.validation.endDateRequired" | translate }}
                </div>
                }
              </div>
              } @if (dateError) {
              <div class="error-message warning-message">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
                  ></path>
                  <line x1="12" y1="9" x2="12" y2="13"></line>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                {{ "shiftForm.validation.dateError" | translate }}
              </div>
              }
            </div>
          </div>

          <!-- Time Range -->
          <div class="form-row">
            <div class="form-group">
              <label for="startTime" class="form-label">
                {{ "shiftForm.fields.startTime" | translate }}
                <span class="required-indicator">*</span>
              </label>
              <div class="input-with-icon">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <input
                  type="time"
                  id="startTime"
                  name="startTime"
                  class="form-control"
                  [(ngModel)]="shiftData.startTime"
                  #startTime="ngModel"
                  required
                />
              </div>
              @if (startTime.invalid && startTime.touched) {
              <div class="error-message">
                @if (startTime.errors?.['required']) {
                <div>
                  {{ "shiftForm.validation.startTimeRequired" | translate }}
                </div>
                }
              </div>
              }
            </div>
            <div class="form-group">
              <label for="endTime" class="form-label">
                {{ "shiftForm.fields.endTime" | translate }}
                <span class="required-indicator">*</span>
              </label>
              <div class="input-with-icon">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <input
                  type="time"
                  id="endTime"
                  name="endTime"
                  class="form-control"
                  [(ngModel)]="shiftData.endTime"
                  #endTime="ngModel"
                  required
                />
              </div>
              @if (endTime.invalid && endTime.touched) {
              <div class="error-message">
                @if (endTime.errors?.['required']) {
                <div>
                  {{ "shiftForm.validation.endTimeRequired" | translate }}
                </div>
                }
              </div>
              }
            </div>
          </div>
        </section>

        <!-- Right Column: Location Selection -->
        <section
          class="shift-section location-section"
          [class.active]="selectedLevel"
        >
          <h3 class="section-subtitle">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polyline points="4 17 10 11 4 5"></polyline>
              <line x1="12" y1="19" x2="20" y2="19"></line>
            </svg>
            {{ "shiftForm.levelAssignment.title" | translate }}
          </h3>

          <div class="form-group">
            <label for="level" class="form-label">{{
              "shiftForm.levelAssignment.levelLabel" | translate
            }}</label>
            <mat-form-field appearance="outline" class="shift-form-input">
              <mat-select
                [(ngModel)]="selectedLevel"
                name="selectedLevel"
                (selectionChange)="onLevelChange()"
              >
                <mat-option value="" disabled>{{
                  "shiftForm.levelAssignment.selectLevel" | translate
                }}</mat-option>
                @for (level of levels; track level) {
                <mat-option [value]="level">
                  {{ level | translate }}
                </mat-option>
                }
              </mat-select>
            </mat-form-field>
            <small class="form-helper-text">
              {{ "shiftForm.levelAssignment.helperText" | translate }}
            </small>
          </div>

          <!-- Dynamic Level-Based Selections -->
          @if (selectedLevel) {
          <div class="level-options-container">
            <!-- Organization Selection -->
            @if ( ['Organization', 'Building', 'Floor',
            'Section'].includes(selectedLevel) ) {
            <div class="level-option">
              <label for="organization" class="form-label">
                {{ "shiftForm.levelAssignment.organization" | translate }}
              </label>
              <mat-form-field appearance="outline" class="shift-form-input">
                <mat-select
                  [(ngModel)]="selectedOrganization"
                  name="selectedOrganization"
                  (selectionChange)="onOrganizationChange()"
                >
                  @for (org of organizations; track org.id) {
                  <mat-option [value]="org.id">
                    {{ org.name }}
                  </mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
            }

            <!-- Building Selection -->
            @if (['Building', 'Floor', 'Section'].includes(selectedLevel)) {
            <div class="level-option">
              <label for="building" class="form-label">
                {{ "shiftForm.levelAssignment.building" | translate }}
              </label>
              <mat-form-field appearance="outline" class="shift-form-input">
                <mat-select
                  [(ngModel)]="selectedBuilding"
                  name="selectedBuilding"
                  (selectionChange)="onBuildingChange()"
                  [disabled]="!buildings.length"
                >
                  @for (building of buildings; track building.id) {
                  <mat-option [value]="building.id">
                    {{ building.name }}
                  </mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
            }

            <!-- Floor Selection -->
            @if (['Floor', 'Section'].includes(selectedLevel)) {
            <div class="level-option">
              <label for="floor" class="form-label">
                {{ "shiftForm.levelAssignment.floor" | translate }}
              </label>
              <mat-form-field appearance="outline" class="shift-form-input">
                <mat-select
                  [(ngModel)]="selectedFloor"
                  name="selectedFloor"
                  (selectionChange)="onFloorChange()"
                  [disabled]="!floors.length"
                >
                  @for (floor of floors; track floor.id) {
                  <mat-option [value]="floor.id">
                    {{ floor.name }}
                  </mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
            }

            <!-- Section Selection -->
            @if (selectedLevel === 'Section') {
            <div class="level-option">
              <label for="section" class="form-label">
                {{ "shiftForm.levelAssignment.section" | translate }}
              </label>
              <mat-form-field appearance="outline" class="shift-form-input">
                <mat-select
                  [(ngModel)]="selectedSection"
                  name="selectedSection"
                  [disabled]="!sections.length"
                >
                  @for (section of sections; track section.id) {
                  <mat-option [value]="section.id">
                    {{ section.name }}
                  </mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
            }
          </div>
          }
        </section>
      </div>

      <!-- Actions -->
      <div class="shift-form-actions">
        <button type="button" class="btn-secondary" (click)="resetForm()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="9 14 4 9 9 4"></polyline>
            <path d="M20 20v-7a4 4 0 0 0-4-4H4"></path>
          </svg>
          {{ "shiftForm.actions.reset" | translate }}
        </button>
        <button type="submit" class="btn-primary" [disabled]="loading">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
          </svg>
          {{
            (isEditMode ? "shiftForm.actions.update" : "shiftForm.actions.save")
              | translate
          }}
        </button>
      </div>
    </form>
    }

    <!-- Loading Indicator -->
    @if (loading) {
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>
        {{
          (isEditMode ? "shiftForm.loadingUpdate" : "shiftForm.loading")
            | translate
        }}
      </p>
    </div>
    }
  </div>
</div>
