<div class="container">
  <!-- Page Header -->
  <app-page-title translationKey="{{ pageTitle | translate }}" />

  <!-- Loading Indicator -->
  @if (isLoading) {
  <div class="text-center py-5">
    <mat-spinner diameter="50" class="mx-auto"></mat-spinner>
    <p class="mt-3">
      {{ "work-location.LOCATION_FORM.LOADING_TEXT" | translate }}
    </p>
  </div>
  } @else {
  <!-- Stepper Container -->
  <div class="stepper-container">
    <!-- Stepper Progress -->
    <div class="steps-container mb-4">
      @for (step of [1, 2, 3, 4]; track step) {
      <div
        class="step"
        [class.active]="currentStep === step"
        [class.completed]="currentStep > step"
      >
        <div class="step-number">{{ step }}</div>
        <div class="step-label">
          @switch (step) { @case (1) {
          {{ "work-location.LOCATION_FORM.STEPS.COUNTRY" | translate }}
          } @case (2) {
          {{ "work-location.LOCATION_FORM.STEPS.AREA" | translate }}
          } @case (3) {
          {{ "work-location.LOCATION_FORM.STEPS.DETAILS" | translate }}
          } @case (4) {
          {{ "work-location.LOCATION_FORM.STEPS.CONFIRM" | translate }}
          } }
        </div>
      </div>
      }
    </div>

    <!-- Stepper Content -->
    <div class="stepper-content">
      <!-- Step 1: Select Country -->
      @if (currentStep === 1) {
      <div class="step-content">
        <h3 class="step-title">
          {{ "work-location.LOCATION_FORM.COUNTRY_STEP.TITLE" | translate }}
        </h3>
        <div class="form-group">
          <label for="country" class="form-label">{{
            "work-location.LOCATION_FORM.COUNTRY_STEP.LABEL" | translate
          }}</label>
          <select
            id="country"
            class="form-select"
            [(ngModel)]="selectedCountry"
            (ngModelChange)="onCountrySelect()"
          >
            <option value="" disabled>
              {{
                "work-location.LOCATION_FORM.COUNTRY_STEP.PLACEHOLDER"
                  | translate
              }}
            </option>
            @for (country of countries; track country.name) {
            <option [value]="country.name">{{ country.name }}</option>
            }
          </select>
          <small class="form-text text-muted">
            {{ "work-location.LOCATION_FORM.COUNTRY_STEP.HINT" | translate }}
          </small>
        </div>
        <div class="step-actions">
          <button
            class="btn btn-primary"
            (click)="nextStep()"
            [disabled]="!selectedCountry"
          >
            {{
              "work-location.LOCATION_FORM.COUNTRY_STEP.NEXT_BUTTON" | translate
            }}
            <i class="fas fa-arrow-right ms-2"></i>
          </button>
        </div>
      </div>
      }

      <!-- Step 2: Select Area -->
      @if (currentStep === 2) {
      <div class="step-content">
        <h3 class="step-title">
          {{ "work-location.LOCATION_FORM.AREA_STEP.TITLE" | translate }}
        </h3>
        <div class="form-group">
          <label for="area" class="form-label">{{
            "work-location.LOCATION_FORM.AREA_STEP.LABEL" | translate
          }}</label>
          <select id="area" class="form-select" [(ngModel)]="selectedArea">
            <option value="" disabled>
              {{
                "work-location.LOCATION_FORM.AREA_STEP.PLACEHOLDER" | translate
              }}
            </option>
            @for (area of areas; track area.id) {
            <option [ngValue]="area">{{ area.name }}</option>
            }
          </select>
          <small class="form-text text-muted">
            {{
              "work-location.LOCATION_FORM.AREA_STEP.HINT"
                | translate : { country: selectedCountry }
            }}
          </small>
        </div>
        <div class="step-actions">
          <button class="btn btn-outline-secondary" (click)="prevStep()">
            <i class="fas fa-arrow-left me-2"></i>
            {{
              "work-location.LOCATION_FORM.AREA_STEP.BACK_BUTTON" | translate
            }}
          </button>
          <button
            class="btn btn-primary"
            (click)="nextStep()"
            [disabled]="!selectedArea"
          >
            {{
              "work-location.LOCATION_FORM.AREA_STEP.NEXT_BUTTON" | translate
            }}
            <i class="fas fa-arrow-right ms-2"></i>
          </button>
        </div>
      </div>
      }

      <!-- Step 3: City Details -->
      @if (currentStep === 3) {
      <div class="step-content">
        <h3 class="step-title">
          {{ "work-location.LOCATION_FORM.DETAILS.NAME" | translate }}
        </h3>

        <!-- City Name -->
        <div class="form-group mb-4">
          <label for="cityName" class="form-label">{{
            "work-location.LOCATION_FORM.DETAILS.NAME" | translate
          }}</label>
          <input
            type="text"
            id="cityName"
            class="form-control"
            [(ngModel)]="cityName"
            [placeholder]="
              'work-location.LOCATION_FORM.DETAILS.NAME_PLACEHOLDER' | translate
            "
            required
            minlength="3"
            maxlength="255"
            #cityNameInput="ngModel"
          />
          @if (cityNameInput.invalid && (cityNameInput.dirty ||
          cityNameInput.touched)) {
          <div class="invalid-feedback d-block">
            @if (cityNameInput.errors?.['required']) {
            <div>
              {{
                "work-location.LOCATION_FORM.DETAILS.NAME_REQUIRED" | translate
              }}
            </div>
            } @if (cityNameInput.errors?.['minlength']) {
            <div>
              {{
                "work-location.LOCATION_FORM.DETAILS.NAME_MINLENGTH" | translate
              }}
            </div>
            } @if (cityNameInput.errors?.['maxlength']) {
            <div>
              {{
                "work-location.LOCATION_FORM.DETAILS.NAME_MAXLENGTH" | translate
              }}
            </div>
            }
          </div>
          }
        </div>

        <!-- User Assignments -->
        <div class="row g-3">
          <!-- Managers -->
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>{{
                "work-location.LOCATION_FORM.DETAILS.MANAGERS" | translate
              }}</mat-label>
              <mat-select [(ngModel)]="selectedManagers" multiple>
                @for (manager of managers; track manager.id) {
                <mat-option [value]="manager.id">
                  {{ manager.firstName }} {{ manager.lastName }}
                </mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Supervisors -->
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>{{
                "work-location.LOCATION_FORM.DETAILS.SUPERVISORS" | translate
              }}</mat-label>
              <mat-select [(ngModel)]="selectedSupervisors" multiple>
                @for (supervisor of supervisors; track supervisor.id) {
                <mat-option [value]="supervisor.id">
                  {{ supervisor.firstName }} {{ supervisor.lastName }}
                </mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Cleaners -->
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>{{
                "work-location.LOCATION_FORM.DETAILS.CLEANERS" | translate
              }}</mat-label>
              <mat-select [(ngModel)]="selectedCleaners" multiple>
                @for (cleaner of cleaners; track cleaner.id) {
                <mat-option [value]="cleaner.id">
                  {{ cleaner.firstName }} {{ cleaner.lastName }}
                </mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <div class="step-actions mt-4">
          <button class="btn btn-outline-secondary" (click)="prevStep()">
            <i class="fas fa-arrow-left me-2"></i>
            {{ "work-location.LOCATION_FORM.DETAILS.BACK_BUTTON" | translate }}
          </button>
          <button
            class="btn btn-primary"
            (click)="nextStep()"
            [disabled]="!cityName || cityName.length < 3"
          >
            {{ "work-location.LOCATION_FORM.DETAILS.NEXT_BUTTON" | translate }}
            <i class="fas fa-arrow-right ms-2"></i>
          </button>
        </div>
      </div>
      }

      <!-- Step 4: Confirmation -->
      @if (currentStep === 4) {
      <div class="step-content">
        <h3 class="step-title">
          {{ "work-location.LOCATION_FORM.CONFIRMATION.TITLE" | translate }}
        </h3>

        <div class="confirmation-card">
          <div class="confirmation-item">
            <span class="confirmation-label"
              >{{
                "work-location.LOCATION_FORM.CONFIRMATION.COUNTRY" | translate
              }}:</span
            >
            <span class="confirmation-value">{{ selectedCountry }}</span>
          </div>
          <div class="confirmation-item">
            <span class="confirmation-label"
              >{{
                "work-location.LOCATION_FORM.CONFIRMATION.AREA" | translate
              }}:</span
            >
            <span class="confirmation-value">{{ selectedArea?.name }}</span>
          </div>
          <div class="confirmation-item">
            <span class="confirmation-label"
              >{{
                "work-location.LOCATION_FORM.CONFIRMATION.NAME" | translate
              }}:</span
            >
            <span class="confirmation-value">{{ cityName }}</span>
          </div>

          <div class="confirmation-item">
            <span class="confirmation-label"
              >{{
                "work-location.LOCATION_FORM.CONFIRMATION.ASSIGNEES"
                  | translate
              }}:</span
            >
            <span class="confirmation-value">
              @if (selectedManagers.length > 0 || selectedSupervisors.length > 0
              || selectedCleaners.length > 0) {
              {{
                selectedManagers.length +
                  selectedSupervisors.length +
                  selectedCleaners.length
              }}
              {{
                "work-location.LOCATION_FORM.CONFIRMATION.ASSIGNEES" | translate
              }}
              } @else {
              {{ "work-location.LOCATION_FORM.CONFIRMATION.NONE" | translate }}
              }
            </span>
          </div>
        </div>

        <div class="alert alert-info mt-4">
          <i class="fas fa-info-circle me-2"></i>
          {{
            "work-location.LOCATION_FORM.CONFIRMATION.REVIEW_INFO" | translate
          }}
        </div>

        <div class="step-actions">
          <button class="btn btn-outline-secondary" (click)="prevStep()">
            <i class="fas fa-arrow-left me-2"></i>
            {{
              "work-location.LOCATION_FORM.CONFIRMATION.BACK_BUTTON" | translate
            }}
          </button>
          <button
            class="btn btn-success"
            (click)="complete()"
            [disabled]="!isFormValid || isSubmitting"
          >
            @if (isSubmitting) {
            <span
              class="spinner-border spinner-border-sm me-2"
              role="status"
              aria-hidden="true"
            ></span>
            {{ submitButtonText | translate }} } @else {
            <i class="fas fa-check me-2"></i>
            {{ submitButtonText | translate }} }
          </button>
        </div>
      </div>
      }
    </div>
  </div>
  }
</div>
