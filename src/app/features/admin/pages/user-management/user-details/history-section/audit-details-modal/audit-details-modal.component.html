<!-- Audit Details Modal -->
<div
  class="modal fade"
  [class.show]="showModal"
  [style.display]="showModal ? 'block' : 'none'"
  tabindex="-1"
  role="dialog"
>
  <div
    class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"
    role="document"
  >
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header bg-gradient-primary text-white">
        <h5 class="modal-title">
          <i class="fas fa-clipboard-check me-2"></i>
          Audit Details
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          (click)="onCloseModal()"
        ></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <!-- Record Info Header -->
        <div class="audit-info-card mb-4" *ngIf="selectedRecordInfo">
          <div class="row">
            <div class="col-md-3">
              <div class="info-item">
                <i class="fas fa-calendar-alt text-primary"></i>
                <span class="label">Date</span>
                <span class="value">{{ selectedRecordInfo.date }}</span>
              </div>
            </div>
            <div class="col-md-3">
              <div class="info-item">
                <i class="fas fa-clock text-primary"></i>
                <span class="label">Time</span>
                <span class="value">{{ selectedRecordInfo.time }}</span>
              </div>
            </div>
            <div class="col-md-3">
              <div class="info-item">
                <i class="fas fa-question-circle text-primary"></i>
                <span class="label">Total Questions</span>
                <span class="value">{{
                  selectedRecordInfo.totalQuestionCount
                }}</span>
              </div>
            </div>
            <div class="col-md-3">
              <div class="info-item">
                <i class="fas fa-check-circle text-success"></i>
                <span class="label">Completed</span>
                <span class="value">{{
                  selectedRecordInfo.completedQuestionCount
                }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="modalLoading" class="text-center py-5">
          <div class="spinner-border text-primary mb-3" role="status"></div>
          <p class="text-muted">Loading audit details...</p>
        </div>

        <!-- Questions List -->
        <div
          *ngIf="!modalLoading && selectedAuditQuestions.length > 0"
          class="questions-container"
        >
          <h6 class="section-title mb-3">
            <i class="fas fa-list-ul me-2"></i>
            Questions & Answers
          </h6>

          <div
            class="question-card"
            *ngFor="let question of selectedAuditQuestions; let i = index"
            [class]="getAnswerStatusClass(question)"
          >
            <div class="question-header">
              <div class="question-number">{{ i + 1 }}</div>
              <div class="question-type">
                <i [class]="getQuestionTypeIcon(question.type)"></i>
                <span>{{ question.type }}</span>
              </div>
              <div class="answer-status">
                <span
                  class="status-badge"
                  [class]="question.isAnswered ? 'answered' : 'unanswered'"
                >
                  <i
                    [class]="
                      question.isAnswered ? 'fas fa-check' : 'fas fa-times'
                    "
                  ></i>
                  {{ question.isAnswered ? "Answered" : "Not Answered" }}
                </span>
              </div>
            </div>

            <div class="question-content">
              <h6 class="question-text">{{ question.questionText }}</h6>

              <!-- Show choices for Radio/Checkbox questions -->
              <div
                *ngIf="
                  question.choices &&
                  question.choices.length > 0 &&
                  (question.type === 'Radio' || question.type === 'Checkbox')
                "
                class="choices-preview"
              >
                <div
                  class="choice-item"
                  *ngFor="let choice of question.choices"
                  [class.selected]="
                    (question.type === 'Radio' &&
                      choice.id === question.choiceIdAnswer) ||
                    (question.type === 'Checkbox' &&
                      question.choiceIdsAnswer?.includes(choice.id))
                  "
                >
                  <div class="choice-content">
                    <img
                      *ngIf="choice.image"
                      [src]="choice.image"
                      class="choice-image"
                      alt="Choice image"
                    />
                    <span class="choice-text">{{ choice.text }}</span>
                  </div>
                  <i
                    *ngIf="
                      (question.type === 'Radio' &&
                        choice.id === question.choiceIdAnswer) ||
                      (question.type === 'Checkbox' &&
                        question.choiceIdsAnswer?.includes(choice.id))
                    "
                    class="fas fa-check-circle choice-selected"
                  ></i>
                </div>
              </div>

              <!-- Answer Section -->
              <div class="answer-section">
                <span class="answer-label">Answer:</span>

                <!-- Rating, RatingStar, RatingEmoji -->
                <ng-container
                  *ngIf="
                    question.type === 'Rating' ||
                    question.type === 'RatingStar' ||
                    question.type === 'RatingEmoji'
                  "
                >
                  <div class="rating-icons">
                    <!-- Stars -->
                    <ng-container
                      *ngIf="
                        question.type === 'Rating' ||
                        question.type === 'RatingStar'
                      "
                    >
                      <i
                        *ngFor="let star of [1, 2, 3, 4, 5]"
                        class="fa-star"
                        [class.fas]="
                          question.rateAnswer && star <= question.rateAnswer
                        "
                        [class.far]="
                          !question.rateAnswer || star > question.rateAnswer
                        "
                        style="color: gold; margin-right: 3px"
                      ></i>
                    </ng-container>

                    <!-- Emojis -->
                    <ng-container *ngIf="question.type === 'RatingEmoji'">
                      <span
                        *ngFor="
                          let emoji of ['😡', '😟', '😐', '😊', '😍'];
                          let idx = index
                        "
                        [class.selected]="
                          question.rateAnswer && idx + 1 === question.rateAnswer
                        "
                        style="
                          font-size: 1.5rem;
                          margin-right: 5px;
                          cursor: default;
                        "
                      >
                        {{ emoji }}
                      </span>
                    </ng-container>
                  </div>
                </ng-container>

                <!-- Other types -->
                <span
                  *ngIf="
                    question.type !== 'Rating' &&
                    question.type !== 'RatingStar' &&
                    question.type !== 'RatingEmoji'
                  "
                  class="answer-value"
                  [class]="question.isAnswered ? 'has-answer' : 'no-answer'"
                >
                  {{ getAnswerText(question) }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- No Questions State -->
        <div
          *ngIf="!modalLoading && selectedAuditQuestions.length === 0"
          class="text-center py-5"
        >
          <i class="fas fa-question-circle fa-3x text-muted mb-3"></i>
          <p class="text-muted">No questions found for this audit.</p>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="onCloseModal()"
        >
          <i class="fas fa-times me-2"></i>Close
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Backdrop -->
<div
  class="modal-backdrop fade"
  [class.show]="showModal"
  *ngIf="showModal"
  (click)="onCloseModal()"
></div>
