<div class="card task-card shadow-sm p-3 mb-3">
  <div class="d-flex justify-content-between align-items-start mb-2">
    <div>
      <span class="badge-custom" [ngClass]="getPriorityClass()">
        {{ "TASKS." + (task?.priority?.toUpperCase() || "NA") | translate }}
      </span>

      <span class="badge-custom" [ngClass]="getStatusClass()">
        {{ getTranslatedStatus(task?.status) | translate }}
      </span>
    </div>

    <!-- Custom Angular Dropdown -->
    <div class="dropdown position-relative">
      <button
        class="btn p-0 border-0 bg-transparent p-1 dropdown-toggle-btn"
        type="button"
        (click)="toggleDropdown($event)"
      >
        <i class="fas fa-ellipsis-h fs-4 text-dark"></i>
      </button>

      <ul
        class="dropdown-menu dropdown-menu-end show custom-dropdown"
        *ngIf="isDropdownOpen"
      >
        <li>
          <a class="dropdown-item" (click)="onViewTask(); closeDropdown()">
            {{ "TASKS.VIEW" | translate }}
          </a>
        </li>
        <li *ngIf="canEdit()">
          <a class="dropdown-item" (click)="onEditTask(); closeDropdown()">
            {{ "TASKS.EDIT" | translate }}
          </a>
        </li>
        <li *ngIf="canDelete()">
          <a
            class="dropdown-item text-danger"
            (click)="onDeleteTask(); closeDropdown()"
          >
            {{ "TASKS.DELETE" | translate }}
          </a>
        </li>
      </ul>
    </div>
  </div>

  <h5
    class="mb-1 text-truncate"
    title="{{ task?.title || ('TASKS.NO_TITLE' | translate) }}"
  >
    {{ task?.title || ("TASKS.NO_TITLE" | translate) }}
  </h5>

  <p
    class="text-muted mb-3 task-description"
    title="{{ task?.description || ('TASKS.NO_DESCRIPTION' | translate) }}"
  >
    {{ task?.description || ("TASKS.NO_DESCRIPTION" | translate) }}
  </p>

  <div class="d-flex justify-content-between align-items-center">
    <div class="text-primary small">
      <i class="bi bi-clock me-1"></i>
      {{ formatTime(task?.startTime) || ("TASKS.NO_TIME" | translate) }}
    </div>
    <div class="d-flex align-items-center">
      <!-- If users exist -->
      <ng-container *ngIf="task?.users?.length > 0; else noUsers">
        <span class="me-1"> {{ task.users.length }}+ </span>

        <img
          *ngFor="let user of task.users.slice(0, 2)"
          [src]="user.image || 'assets/user-avater.png'"
          class="avatar rounded-circle me-1"
          [alt]="user.userName"
          [title]="user.firstName + ' ' + user.lastName"
        />
      </ng-container>

      <!-- Fallback -->
      <ng-template #noUsers>
        <span class="text-muted small">
          {{ "TASKS.NO_USERS" | translate }}
        </span>
      </ng-template>
    </div>
  </div>
</div>
